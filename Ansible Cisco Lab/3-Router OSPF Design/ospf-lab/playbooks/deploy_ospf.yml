---
- name: Deploy OSPF Lab Configuration
  hosts: routers
  gather_facts: false
  
  handlers:
    - name: save config
      cisco.ios.ios_config:
        save_when: always

  tasks:
    - name: Gather device facts
      cisco.ios.ios_facts:
        gather_subset: min
      
    - name: Display current IOS version
      debug:
        msg: "{{ ansible_net_version }}"

    - name: Apply base interface configuration
      include_role:
        name: base_interfaces
      tags: ['interfaces', 'base']

    - name: Apply OSPF configuration
      include_role:
        name: ospf
      tags: ['ospf', 'routing']

    - name: Final verification - Full OSPF status
      cisco.ios.ios_command:
        commands:
          - show ip ospf
          - show ip ospf interface brief
          - show ip ospf database
      register: final_check
      tags: ['verify']

    - name: Display final OSPF status
      debug:
        var: final_check.stdout_lines
      tags: ['verify']